# The MIT License (MIT)
#
# Copyright (c) 2020 ETH Zurich
#
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the "Software"), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in all
# copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
# SOFTWARE.

# GENERATION CONSTANTS
BASE_NAME: "telesat_1015"
NICE_NAME: "Telesat-1015"


################################################################
# The below constants are taken from Starlink's FCC filing as below:
# [1]: https://fcc.report/IBFS/SAT-MOD-20190830-00087
################################################################

# TELESAT 1015
#TODO: consider shell as an object
satellite: {}
  #just for buffer conf
ECCENTRICITY: 0.0000001  # Circular orbits are zero, but pyephem does not permit 0, so lowest possible value
ARG_OF_PERIGEE_DEGREE: 0.0
PHASE_DIFF: True

ALTITUDE_M: 1015000  # Altitude ~630 km
NUM_ORBS: 27
NUM_SATS_PER_ORB: 13
INCLINATION_DEGREE: 98.98

ISL_POLAR_DESACTIVATION_ANOMALY_DEGREE: 75
# orbites circulaires, périgée confondu avec le noeud ascendant à l'équateur, lorsque l'anomalie atteint 90°, le satellite est à sa latitude maximale. 
# lorsque l'anomalie dépasse ISL_POLAR_DESACTIVATION_ANOMALY_DEGREE, les isl adjacents sont désactivés
# Par symétrie centrale, les ISL sont désactivés lorsque l'anomalie et comprise entre ISL_POLAR_DESACTIVATION_ANOMALY_DEGREE et 180-ISL_POLAR_DESACTIVATION_ANOMALY_DEGREE
# ou entre -ISL_POLAR_DESACTIVATION_ANOMALY_DEGREE et ISL_POLAR_DESACTIVATION_ANOMALY_DEGREE-180
# Todo: différencier désactivations à droite et à gauche

#same names as in debit_gsl
TYPES_OBJETS_SOL: ['gateway', 'ue', 'server'] #/!\ /!\ /!\ NE PAS CHANGER L'ORDRE /!\ /!\ /!\ ou modifier l'écriture des interfaces et/ou la génération des objets sol

#interface allocation: lo, isl, gsl, finally terrestrial links
#a change in interface configuration must be reflected in the system configuration (topology-satellite-network files)

gateway: 
  positions: os_Lille # ground_stations_cities_sorted_by_estimated_2025_pop_top_100_basic: 100 biggest cities, Hypatia base file; ground_stations_cities_by_estimated_2025_pop_300k_UN: +300k cities, United Nations estimate
  nombre: 1 #random, give IDs and place them, or set it in config?
  minElevation: 20 #degrees above horizon

ue:
  positions: os_1villes_telesat1015 #villesGlobe_telesat1015 #os_1villes_telesat1015 #randomGlobe_telesat1015 : randomGlobe= universel sur Terre, _{constellation_file_name.replace('_', '')} = à portée de la constellation . villesGlobe: Kent distribution around big cities
  minElevation: 20 #degrees above horizon
  nombre: $config/nb-UEs-sol #voir dans config
  estimDelai: $config/estimDelai/extremite #special for  extremities of the connection.
  
server:
  positions: os_Lille
  nombre: 1
  estimDelai: $config/estimDelai/extremite #special for  extremities of the connection.

#syntaxe des liens:
#   [nom, dico propriétés des interfaces, dico propriétés du lien ]
# Pour définir un lien il faut des objets (NetDevice dans ns3) sur lesquels seront créées des interfaces. 
# Ces interfaces permettront d'accéder à un canal qui transportera l'information.
#     La principale propriété d'une interface est son débit. 
#     Dans ns3, les interfaces sont crées l'une après l'autre, en commençant par la loopback (lo)
#     Suivent les autres interfaces, définies ici. 
#     L'ordre de définition des interfaces est très important, car il sera utilisé par l'algorithme de routage.
#     Les tables de routages sont définies avant la simulation et mises à jour régulièrement. 
#     Les algorithmes prennent en compte un numéro d'interface. 
# Un canal aggrège des interfaces, et transmet l'information d'une interface à l'autre (ou 1 vers plusieurs, non implémenté pour l'instant)

# le nom permet de définir le canal, et crée une interface par objet relié
# isl "lien inter-satellite" définit un canal simple entre 2 satellites. La délai est basé sur la distance géométrique entre les deux satellites.
# gsl "lien sol-satellite" définit un canal entre des objets divers. Tous peuvent transmettre à tous.
# tl "lien terrestre" définit un canal entre 2 ordinateurs. 

# "dico propriétés" contient toutes les informations complémentaires nécessaires à la création du lien
# exemples d'attributs utiles définis dans le "dico propriétés"
# agg_max_bandwidth


# Le dico propriétés est constitué des paramètres des différents objets.
# En clé principale, le nom des objets
# Puis: 
#     Attribut : Unité_ns3~Valeurns3
# Pour définir et ajouter un contrôleur de traffic, spécifier
#   "QueueDisc" : ns3::classe_de_traffic_control
#    Attribut : Unité_ns3 Valeurns3 (avec un espace entre le type et la valeur)
# On peut ajouter le préfixe Child
# un attribut particulier: le netdevice a une file d'attente d'émission, DropTailQueue. Seule sa taille est définie, avec 
#    devQMaxSize: Valeurns3 (par ex "2kB", "100p") 
# les arguments non typés ne sont lus que par python
# Les paramètres des objets sont ceux d'un Netdevice, notamment
# 'DataRate': "DataRate~[debit][unité]" //débit du netdevice
# maxSatellites: uint //pour les gsl, limite le nombre de satellites avec lesquels communiquer (dans la limite de ceux visibles avec minElevation)

LINKS:
    - ["isl", {"satellite": { 'DataRate': "DataRate~$config/debit-if-isl/Mbps"}}, {"limiteDist": True, "detraque": $config/deteriorISL, "estimDelai": $config/estimDelai/isl }] #interfaces between satellites, to be used together with the "plus grid"
    - ["gsl", { "satellite": { 'DataRate': "DataRate~$config/debit-if-gsl/satellite/Mbps"}, "ue": { 'DataRate': "DataRate~$config/debit-if-gsl/ue/Mbps" }}, {"limiteDist": True, "penalite_s": 10, "estimDelai": $config/estimDelai/gsl }] # although the ue has only 1 interface, it only makes 1 connection, so it does not need to choose the closest sat
    - ["gsl", { "satellite": { 'DataRate': "DataRate~$config/debit-if-gsl/satellite/Mbps"}, "gateway": { 'DataRate': "DataRate~$config/debit-if-gsl/gateway/Mbps", maxSatellites: 5 }}, {"limiteDist": True, "penalite_s": 10, "estimDelai": $config/estimDelai/isl }] # in reality, the gateway has a limited number of interfaces, and connects many users. To maximize bandwidth (not implemented here), we select the 5 closest satellites
    # GSL
    - ["tl", { "server": { 'DataRate': "DataRate~$config/debit-if-gsl/gateway/Mbps", $config/srvTrafficControl}, "gateway": { 'DataRate': "DataRate~$config/debit-if-gsl/gateway/Mbps"}}, {"Delay": "Time~5ms", "estimDelai": 5}] # gateway
    #- "tl", {agg_max_bandwidth: 1}, 1 #one-one, with 1 server


ENDPOINTS:
  - ue # Its datarate is used by default as reference for setting up commodities, datarate...
  - server
